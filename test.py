from control.matlab import lsim

from experiment import vehicle_turning, RLC_circuit, dc_motor_position, aircraft_pitch, quadrotor
import os
import numpy as np

if __name__ == '__main__':
    exp = dc_motor_position
    sys = exp.sysc
    dt = exp.Ts
    control = np.array([[150., 100.04370128, 100.07928921, 99.41602695, 4.4366523,
                         -150., -150., -150., -150., -150.]])
    print(control.size)
    x_0 = np.array([[-3.45899408], [-0.10767091], [-0.76250113]])

    for i in range(control.size):
        cin = control[0, i]
        yout, T, xout = lsim(sys, cin, [0, dt], x_0)
        if len(xout.shape) == 1:
            x_0 = xout[-1]
        else:
            x_0 = xout[-1, :].T
        print(xout[-1, :])

    # A = exp.sysd.A
    # B = exp.sysd.B
    # C = exp.sysd.C
    # D = exp.sysd.D
    # print(exp.sysd)
    #
    # for i in range(control.size):
    #     cin = control[0, i]
    #     xout = np.dot(A, x_0) + np.dot(B, cin)
    #     yout = np.dot(C, x_0) + np.dot(D, cin)
    #     x_0 = xout.copy()
    #     print(x_0)

    '''
    [-3.43076797  0.94575552 26.5655592]
    [-3.25481799  2.53082133 39.88164941]
    [-2.93302246  3.86452323 50.78775685]
    [-2.48970635  4.96516131 59.59449761]
    [-1.97046843  5.21517491 49.58665763]
    [-1.50849083  3.68440396 13.39940807]
    [-1.26731493   1.08202333 - 16.22417229]
    [-1.29217852 - 1.54463538 - 40.47308571]
    [-1.56619312 - 3.87733736 - 60.32190953]
    [-2.0556952 - 5.85394798 - 76.56885666]

    == == == == recovery == == == == ==
    Solve = 8.559226989746094e-05
    seconds;
    Total = 0.00046443939208984375
    seconds.
    [[-3.45899408 - 3.43076796 - 3.00310172 - 2.21364795 - 4.
      - 4. - 4. - 3.5324713 - 2.87638856 - 2.15094989
      - 1.4]
     [-0.10767091    0.94575552    6.66918658 - 100. - 30.4660463
     - 5.54047052    2.56917078    5.55214437    6.6493731     7.05296731
     7.20142158]
    [-0.76250113    100.    100.    100.    100.    100.    100.
    100.    100.    100.    54.66907458]]
    [[150.          100.04370128  100.07928921   99.41602695    4.4366523
      - 150. - 150. - 150. - 150. - 150.]]
    r_control = [[150.          100.04370128  100.07928921   99.41602695    4.4366523
                  - 150. - 150. - 150. - 150. - 150.]]
    == == == == == == == == ==
    '''
